{% extends 'app1/base.html' %}
{% load static from staticfiles %}

{% block linkscript %}

<link rel="icon" href="https://static.jianshukeji.com/highcharts/images/favicon.ico">
<meta name="viewport" content="width=device-width, initial-scale=1">

<script src="https://img.hcharts.cn/highcharts/highcharts.js"></script>
<script src="https://img.hcharts.cn/highcharts/modules/exporting.js"></script>
<script src="https://img.hcharts.cn/highcharts/modules/histogram-bellcurve.js"></script>
<script src="https://img.hcharts.cn/highcharts-plugins/highcharts-zh_CN.js"></script>

{% endblock linkscript %}


{% block base %}

{#    GBM参数信息输入   #}
<h1> 几何布朗运动模拟 </h1><br>

<form id="gbm_params" method="post">
    {% csrf_token %}
    定价日期： <input id="pricing_date_y" name="pricing_date_y"  value=2017 style="width: 80px; height: 30px; background-color: whitesmoke">年
    <input id="pricing_date_m" name="pricing_date_m"  value=1 style="width: 80px; height: 30px; background-color: whitesmoke">月
    <input id="pricing_date_d" name="pricing_date_d"  value=1 style="width: 80px; height: 30px; background-color: whitesmoke">日<br>

    到期日期： <input id="final_date_y" name="final_date_y"  value=2018 style="width: 80px; height: 30px; background-color: whitesmoke">年
    <input id="final_date_m" name="final_date_m"  value=1 style="width: 80px; height: 30px; background-color: whitesmoke">月
    <input id="final_date_d" name="final_date_d"  value=1 style="width: 80px; height: 30px; background-color: whitesmoke">日<br>


    标的现价： <input id="initial_value" name="initial_value" value=100 style="width: 80px; height: 30px; background-color: whitesmoke"><br>
    年波动率： <input id="volatility" name="volatility"  value=0.1 style="width: 80px; height: 30px; background-color: whitesmoke"><br>
    时间频率： <input id="frequency" name="frequency" value='M' style="width: 80px; height: 30px; background-color: whitesmoke"><br>
    短期利率： <input id="csr" name="csr" value=0.05 style="width: 80px; height: 30px; background-color: whitesmoke"><br>
    路径数量： <input id="paths" name="paths" value=1000 style="width: 80px; height: 30px; background-color: whitesmoke"><br>

    货币种类： <input id="currency" name="currency" value='EUR' style="width: 80px; height: 30px; background-color: whitesmoke"><br>
    <button id="submit" type="submit" style="width: 80px; height: 30px; background-color: greenyellow">模拟</button>
</form>

<div id="container" style="width: 800px; height: 400px;"></div>



<button onclick="requestData();">&nbsp;请求 JSON&nbsp;</button>

{# 提交参数信息#}
<script type="text/javascript">

var chart = null;

$(document).ready(function() {
  chart = Highcharts.chart('container', {
    chart: {
      type: 'spline',
      events: {
        load: requestData // 图表加载完毕后执行的回调函数
      }
    },
    title: {
      text: 'Live random data'
    },
    xAxis: {
      type: 'datetime',
      tickPixelInterval: 150,
      maxZoom: 20 * 1000
    },
    yAxis: {
      minPadding: 0.2,
      maxPadding: 0.2,
      title: {
        text: 'Value',
        margin: 80
      }
    },
    series: [{
      name: '随机数据',
      data: []
    }]
  });
})


{#function requestData() {#}
{#  $.ajax({#}
{#    url: '/options/gbm_json/',#}
{#    success: function(point) {#}
{#      var series = chart.series[0],#}
{#        shift = series.data.length > 20; // 当数据点数量超过 20 个，则指定删除第一个点#}
{##}
{#      // 新增点操作#}
{#      //具体的参数详见：https://api.hcharts.cn/highcharts#Series.addPoint#}
{#      chart.series[0].addPoint(point, true, shift);#}
{##}
{#      // 一秒后继续调用本函数#}
{#      setTimeout(requestData, 1000);#}
{#    },#}
{#    cache: false#}
{#  });#}
{#}#}

function requestData() {
  $.ajax({
    url: '/options/gbm_json/',
    success: function(point) {
      var series = chart.series[0],
        shift = series.data.length > 20; // 当数据点数量超过 20 个，则指定删除第一个点

      // 新增点操作
      //具体的参数详见：https://api.hcharts.cn/highcharts#Series.addPoint
      chart.series[0].addPoint(point, true, shift);

      // 一秒后继续调用本函数
    },
    cache: false
  });
}


</script>


{% endblock base %}